<!doctype html>

<html lang="en">
 
  <head>
 
    <meta charset="UTF-8" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />

   <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

    <title>Outdoor Safety Checker</title>
  </head>

  <body>
    <nav>
      <a href="/">Home</a> | 
    
      <a href="/about">About</a> | 
      <a href="/feature">Feature</a>
    </nav>

    <h1>Outdoor Safety Checker</h1>
   
    <p>Please enter a city name to check the outdoor conditions (weather + air quality).</p>

    <label for="cityInput">City:</label>
  
    <input id="cityInput" type="text" placeholder="Baltimore" />

    
    <button id="checkBtn">Check The Conditions</button>

    <h2>Result</h2>
    <div id="result">No data yet.</div>

   <h2 data-aos="fade-up">Air Quality Chart</h2>
<canvas id="aqiChart" width="400" height="200"></canvas>
   

    <h2>Safety Tips</h2>
    <div id="tips">Loading safety tips...</div>

    <script>
  AOS.init();

  async function loadQuotes() {
    const tipsDiv = document.getElementById("tips");

    try {
      const res = await fetch("/api/quotes");
      if (!res.ok) throw new Error("Quotes API failed");

      const quotes = await res.json();

      tipsDiv.innerHTML = "";
      quotes.forEach((q) => {
        const p = document.createElement("p");
        p.textContent = q.text;
        tipsDiv.appendChild(p);
      });
    } catch (err) {
      tipsDiv.textContent = "Could not load safety tips.";
      console.error(err);
    }
  }

  loadQuotes();

  const input = document.getElementById("cityInput");
  const button = document.getElementById("checkBtn");
  const result = document.getElementById("result");

  button.addEventListener("click", async () => {
    const city = input.value.trim();

    if (!city) {
      result.textContent = "Please enter a city name.";
      return;
    }

    result.textContent = "Loading...";

    try {
      const res = await fetch(`/api/outdoor?city=${encodeURIComponent(city)}`);
      if (!res.ok) throw new Error("Outdoor API failed");

      const data = await res.json();

      result.innerHTML = `
        <p><strong>City:</strong> ${data.city}</p>
        <p><strong>Temperature:</strong> ${data.temperature_f}Â°F</p>
        <p><strong>Air Quality:</strong> ${data.air_quality}</p>
        <p><strong>AQI:</strong> ${data.aqi}</p>
      `;

      const canvas = document.getElementById("aqiChart");
      const ctx = canvas.getContext("2d");

      if (window.aqiChart && typeof window.aqiChart.destroy === "function") {
        window.aqiChart.destroy();
      }

      window.aqiChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["AQI"],
          datasets: [
            {
              label: "Air Quality Index",
              data: [Number(data.aqi) || 0],
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true },
          },
        },
      });
    } catch (err) {
      result.textContent = "Error fetching outdoor data.";
      console.error(err);
    }
  });
</script>
  </body>
</html>
